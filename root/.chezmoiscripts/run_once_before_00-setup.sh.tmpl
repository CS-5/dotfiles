{{ includeTemplate "script-header.sh" . -}}

show_progress "Setting up directories"

mkdir -p {{ .binDirAbs | quote }}
mkdir -p {{ .dataDirAbs | quote }}
mkdir -p {{ .configDirAbs | quote }}
mkdir -p ~/.ssh
mkdir -p ~/.config/fish/{functions,completions,conf.d}

{{ if .isWorkDev -}}
mkdir -p {{ .persistDirAbs | quote }}
{{ end -}}

log_success "Directory setup complete"

show_progress "Installing/updating package managers"

{{ if .isMac -}}
if ! command -v brew >/dev/null 2>&1; then
    log_info "Installing Homebrew"
    /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
    eval "$(/opt/homebrew/bin/brew shellenv)"
else
    log_info "Homebrew already installed"
fi
{{ else if eq .osId "linux-debian" "linux-ubuntu" -}}
show_progress "Updating package database"
{{ if .needsSudo -}}
sudo apt-get update
{{ else -}}
apt-get update
{{ end -}}

{{ end -}}

log_success "Package managers ready"
